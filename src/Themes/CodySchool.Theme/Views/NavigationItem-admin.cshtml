@{
    TagBuilder tag = Tag(Model, "div");
    tag.AddCssClass("menu-item");
    if (Model.HasItems)
    {
        tag.AddCssClass("menu-accordion");
        tag.Attributes["data-kt-menu-trigger"] = "click";
    }

    // Morphing the shape to keep Model untouched
    Model.Metadata.Alternates.Clear();
    Model.Metadata.Type = "NavigationItemLink";
    Model.Metadata.Alternates.Add("NavigationItemLink_Id__" + Model.Id);

    if ((bool)Model.Selected)
    {
        tag.AddCssClass("active");
    }

    tag.InnerHtml.AppendHtml(await DisplayAsync(Model));

    //render submenu
    if (Model.HasItems)
    {
        TagBuilder subMenu = Tag(Model, "div");
        subMenu.AddCssClass("menu-sub menu-sub-accordion");

        foreach (var item in Model.Items)
        {
            TagBuilder subMenuItem = Tag(Model, "div");
            subMenuItem.AddCssClass("menu-item");
            subMenuItem.Attributes["data-kt-menu-trigger"] = "click";
            subMenuItem.InnerHtml.AppendHtml(await DisplayAsync(item));
            subMenu.InnerHtml.AppendHtml(subMenuItem);
        }
        tag.InnerHtml.AppendHtml(subMenu);
    }
}

@tag